"use strict";
var cmark = require("cmark");

exports.parseAST = function(markdown) {
  var transform = function(items) {
    for (var _iterator = items[Symbol.iterator](), _step; !(_step = _iterator.next()).done; ) {
      var _item = _step.value;
      if (_item.children) {
        transform(_item.children);
      }

      // Split lines of code for fenced code, to improve diffs
      if (_item.t === "FencedCode") {
        _item.inline_content = _item.string_content.split("\n")
          .slice(0, -1)
          .map(function(l) {
          return { t: "CodeLine", c: l };
        });
        _item.string_content = null;
      }
    }
  };

  var _reader = new cmark.DocParser();
  var _ast = _reader.parse(markdown);
  transform([_ast]);
  return _ast;
};

"use strict";
var shapes = {
  document: "note",
  block: "box",
  inline: "oval",
};


var solarizedLight = {
  back: "#fdf6e3",
  fill: "#eee8d5",
  font: "#073642",
  strg: "#586e75",
  edge: "#002b36",
  code: "#268bd2",
};

var solarizedDark = {
  back: "#002b36",
  fill: "#073642",
  font: "#fdf6e3",
  strg: "#eee8d5",
  edge: "#93a1a1",
  code: "#2aa198",
};

exports.palettes = { solarizedLight: solarizedLight, solarizedDark: solarizedDark };


var defaults = {
  palette: solarizedLight,
  fontsize: 14,
  fontname: "Inconsolata",
};


exports.exportDot = function(ast, filename, options) {
  if (options === undefined)
    options = {};

  var _pal  = options.palette  || defaults.palette;
  var _size = options.fontsize || defaults.fontsize;
  var _font = options.fontname || defaults.fontname;

  var _out = ["digraph \"" + filename + "\" {",
             "graph [rankdir=\"LR\", bgcolor=\"" + _pal.back + "\"];",
             "node [style=\"filled\", fontcolor=\"" + _pal.font + "\", fillcolor=\"" + _pal.fill + "\", color=\"" + _pal.edge + "\", fontsize=" + _size + ", fontname=\"" + _font + "\"];",
             "edge [color=\"" + _pal.edge + "\"];"
            ];
  var _n = 0;

  var builder = function(_n) {
    return function(_out) {
      return function(_pal) {
        return function(items, type) {
          var _ids = [];

          for (var _iterator = items[Symbol.iterator](), _step; !(_step = _iterator.next()).done; ) {
            var _item = _step.value;
            var _id = _n++;
            var _children = [];
            if (_item.children) {
              _children = _children.concat(builder(_item.children, "block"));
            }
            if (_item.inline_content) {
              _children = _children.concat(builder(_item.inline_content, "inline"));
            }
            if (Array.isArray(_item.c)) {
              _children = _children.concat(builder(_item.c, "inline"));
            }
            if (Array.isArray(_item.label)) {
              _children = _children.concat(builder(_item.label, "inline"));
            }
            var _shape = shapes[type];
            var _label = _item.t;
            var _more = "";
            if (_item.t === "Str") {
              _label = "'" + _item.c + "'";
              _more = ", fontcolor=\"" + _pal.strg + "\"";
            } else if (_item.t === "CodeLine" || _item.t === "Code") {
              _label = _item.c;
              _more = ", fontcolor=\"" + _pal.code + "\"";
            } else if (_item.t === "Link") {
              _more = ", href=\"" + _item.destination + "\"";
            }
            _label = _label.replace(/["\\]/g, "\\$&");
            _out.push("  n" + _id + " [label=\"" + _label + "\", shape=\"" + _shape + "\"" + _more + "];");

            for (var _child, t$5$0 = regeneratorRuntime.values(_children), t$5$1; !(t$5$1 = t$5$0.next()).done; ) {
              _child = t$5$1.value;
              _out.push("  n" + _id + " -> n" + _child + ";");
            }

            _ids.push(_id);
          }

          return _ids;
        };
      };
    };
  }(_n)(_out)(_pal);

  builder([ast], "document");
  _out.push('}');
  return _out.join("\n");
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL25vbm8vZGV2L21kZGlmZi9zcmMvYXN0LmpzIiwiL2hvbWUvbm9uby9kZXYvbWRkaWZmL3NyYy9kb3QuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7O0FBRTVCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtFQUNwQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt5QkFDWCxDQUFDLENBQUMsQ0FBQyxDQUFDOztNQUNuQixDQUFDLEVBQUUsTUFBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO1FBQ2pCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztNQUMxQjs7O01BR0EsQ0FBQyxFQUFFLE1BQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7YUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7VUFDbEQsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1VBQ1osQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFDO2lCQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtTQUFFLENBQUM7YUFDbEMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO01BQzVCOztHQUVIOztjQUVVLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztXQUN6QixTQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQy9CLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFDLENBQUM7RUFDaEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUs7QUFDWixDQUFDOzs7QUN2QkQsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtFQUNYLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2hCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNaLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEIsQ0FBQzs7O0FBR0QsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7RUFDbkIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2pCLENBQUM7O0FBRUQsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO0VBQ2xCLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNmLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNmLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNmLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNmLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNmLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNqQixDQUFDOztBQUVELENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxnQ0FBZ0IsK0JBQWdCLENBQUM7OztBQUdwRCxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtFQUNiLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7RUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0VBQ1osQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN6QixDQUFDOzs7QUFHRCxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFBTixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUFOLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUUsQ0FBQzs7WUFDMUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7V0FFdkMsRUFBRSxnQkFBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQU87dURBQ1MsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFNOzBEQUNQLENBQUMsQ0FB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O0VBQ2IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0NBQ3RCIiwiZmlsZSI6Im1kZGlmZi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBjbWFyayA9IHJlcXVpcmUoXCJjbWFya1wiKTtcblxuZXhwb3J0cy5wYXJzZUFTVCA9IGZ1bmN0aW9uKG1hcmtkb3duKSB7XG4gIHZhciB0cmFuc2Zvcm0gPSBmdW5jdGlvbihpdGVtcykge1xuICAgIGZvciAobGV0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgIGlmIChpdGVtLmNoaWxkcmVuKSB7XG4gICAgICAgIHRyYW5zZm9ybShpdGVtLmNoaWxkcmVuKTtcbiAgICAgIH1cblxuICAgICAgLy8gU3BsaXQgbGluZXMgb2YgY29kZSBmb3IgZmVuY2VkIGNvZGUsIHRvIGltcHJvdmUgZGlmZnNcbiAgICAgIGlmIChpdGVtLnQgPT09IFwiRmVuY2VkQ29kZVwiKSB7XG4gICAgICAgIGl0ZW0uaW5saW5lX2NvbnRlbnQgPSBpdGVtLnN0cmluZ19jb250ZW50LnNwbGl0KFwiXFxuXCIpXG4gICAgICAgICAgLnNsaWNlKDAsIC0xKVxuICAgICAgICAgIC5tYXAobCA9PiAoeyB0OiBcIkNvZGVMaW5lXCIsIGM6IGwgfSkpO1xuICAgICAgICBpdGVtLnN0cmluZ19jb250ZW50ID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgbGV0IHJlYWRlciA9IG5ldyBjbWFyay5Eb2NQYXJzZXIoKTtcbiAgbGV0IGFzdCA9IHJlYWRlci5wYXJzZShtYXJrZG93bik7XG4gIHRyYW5zZm9ybShbYXN0XSk7XG4gIHJldHVybiBhc3Q7XG59O1xuIiwidmFyIHNoYXBlcyA9IHtcbiAgZG9jdW1lbnQ6IFwibm90ZVwiLFxuICBibG9jazogXCJib3hcIixcbiAgaW5saW5lOiBcIm92YWxcIixcbn07XG5cblxudmFyIHNvbGFyaXplZExpZ2h0ID0ge1xuICBiYWNrOiBcIiNmZGY2ZTNcIixcbiAgZmlsbDogXCIjZWVlOGQ1XCIsXG4gIGZvbnQ6IFwiIzA3MzY0MlwiLFxuICBzdHJnOiBcIiM1ODZlNzVcIixcbiAgZWRnZTogXCIjMDAyYjM2XCIsXG4gIGNvZGU6IFwiIzI2OGJkMlwiLFxufTtcblxudmFyIHNvbGFyaXplZERhcmsgPSB7XG4gIGJhY2s6IFwiIzAwMmIzNlwiLFxuICBmaWxsOiBcIiMwNzM2NDJcIixcbiAgZm9udDogXCIjZmRmNmUzXCIsXG4gIHN0cmc6IFwiI2VlZThkNVwiLFxuICBlZGdlOiBcIiM5M2ExYTFcIixcbiAgY29kZTogXCIjMmFhMTk4XCIsXG59O1xuXG5leHBvcnRzLnBhbGV0dGVzID0geyBzb2xhcml6ZWRMaWdodCwgc29sYXJpemVkRGFyayB9O1xuXG5cbnZhciBkZWZhdWx0cyA9IHtcbiAgcGFsZXR0ZTogc29sYXJpemVkTGlnaHQsXG4gIGZvbnRzaXplOiAxNCxcbiAgZm9udG5hbWU6IFwiSW5jb25zb2xhdGFcIixcbn07XG5cblxuZXhwb3J0cy5leHBvcnREb3QgPSBmdW5jdGlvbihhc3QsIGZpbGVuYW1lLCBvcHRpb25zPXt9KSB7XG4gIGxldCBwYWwgID0gb3B0aW9ucy5wYWxldHRlICB8fCBkZWZhdWx0cy5wYWxldHRlO1xuICBsZXQgc2l6ZSA9IG9wdGlvbnMuZm9udHNpemUgfHwgZGVmYXVsdHMuZm9udHNpemU7XG4gIGxldCBmb250ID0gb3B0aW9ucy5mb250bmFtZSB8fCBkZWZhdWx0cy5mb250bmFtZTtcblxuICBsZXQgb3V0ID0gW2BkaWdyYXBoIFwiJHsgZmlsZW5hbWUgfVwiIHtgLFxuICAgICAgICAgICAgIGBncmFwaCBbcmFua2Rpcj1cIkxSXCIsIGJnY29sb3I9XCIke3BhbC5iYWNrfVwiXTtgLFxuICAgICAgICAgICAgIGBub2RlIFtzdHlsZT1cImZpbGxlZFwiLCBmb250Y29sb3I9XCIke3BhbC5mb250fVwiLCBmaWxsY29sb3I9XCIkeyBwYWwuZmlsbCB9XCIsIGNvbG9yPVwiJHsgcGFsLmVkZ2UgfVwiLCBmb250c2l6ZT0keyBzaXplIH0sIGZvbnRuYW1lPVwiJHsgZm9udCB9XCJdO2AsXG4gICAgICAgICAgICAgYGVkZ2UgW2NvbG9yPVwiJHsgcGFsLmVkZ2UgfVwiXTtgXG4gICAgICAgICAgICBdO1xuICBsZXQgbiA9IDA7XG5cbiAgdmFyIGJ1aWxkZXIgPSBmdW5jdGlvbihpdGVtcywgdHlwZSkge1xuICAgIGxldCBpZHMgPSBbXTtcbiAgICBmb3IgKGxldCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgICBsZXQgaWQgPSBuKys7XG4gICAgICBsZXQgY2hpbGRyZW4gPSBbXTtcbiAgICAgIGlmIChpdGVtLmNoaWxkcmVuKSB7XG4gICAgICAgIGNoaWxkcmVuID0gY2hpbGRyZW4uY29uY2F0KGJ1aWxkZXIoaXRlbS5jaGlsZHJlbiwgXCJibG9ja1wiKSk7XG4gICAgICB9XG4gICAgICBpZiAoaXRlbS5pbmxpbmVfY29udGVudCkge1xuICAgICAgICBjaGlsZHJlbiA9IGNoaWxkcmVuLmNvbmNhdChidWlsZGVyKGl0ZW0uaW5saW5lX2NvbnRlbnQsIFwiaW5saW5lXCIpKTtcbiAgICAgIH1cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW0uYykpIHtcbiAgICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5jb25jYXQoYnVpbGRlcihpdGVtLmMsIFwiaW5saW5lXCIpKTtcbiAgICAgIH1cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW0ubGFiZWwpKSB7XG4gICAgICAgIGNoaWxkcmVuID0gY2hpbGRyZW4uY29uY2F0KGJ1aWxkZXIoaXRlbS5sYWJlbCwgXCJpbmxpbmVcIikpO1xuICAgICAgfVxuICAgICAgbGV0IHNoYXBlID0gc2hhcGVzW3R5cGVdO1xuICAgICAgbGV0IGxhYmVsID0gaXRlbS50O1xuICAgICAgbGV0IG1vcmUgPSBcIlwiO1xuICAgICAgaWYgKGl0ZW0udCA9PT0gXCJTdHJcIikge1xuICAgICAgICBsYWJlbCA9IGAnJHsgaXRlbS5jIH0nYDtcbiAgICAgICAgbW9yZSA9IGAsIGZvbnRjb2xvcj1cIiR7IHBhbC5zdHJnIH1cImA7XG4gICAgICB9IGVsc2UgaWYgKGl0ZW0udCA9PT0gXCJDb2RlTGluZVwiIHx8IGl0ZW0udCA9PT0gXCJDb2RlXCIpIHtcbiAgICAgICAgbGFiZWwgPSBpdGVtLmM7XG4gICAgICAgIG1vcmUgPSBgLCBmb250Y29sb3I9XCIkeyBwYWwuY29kZSB9XCJgO1xuICAgICAgfSBlbHNlIGlmIChpdGVtLnQgPT09IFwiTGlua1wiKSB7XG4gICAgICAgIG1vcmUgPSBgLCBocmVmPVwiJHsgaXRlbS5kZXN0aW5hdGlvbiB9XCJgO1xuICAgICAgfVxuICAgICAgbGFiZWwgPSBsYWJlbC5yZXBsYWNlKC9bXCJcXFxcXS9nLCBcIlxcXFwkJlwiKTtcbiAgICAgIG91dC5wdXNoKGAgIG4keyBpZCB9IFtsYWJlbD1cIiR7IGxhYmVsIH1cIiwgc2hhcGU9XCIkeyBzaGFwZSB9XCIkeyBtb3JlIH1dO2ApO1xuICAgICAgZm9yIChsZXQgY2hpbGQgb2YgY2hpbGRyZW4pIHtcbiAgICAgICAgb3V0LnB1c2goYCAgbiR7IGlkIH0gLT4gbiR7IGNoaWxkIH07YCk7XG4gICAgICB9XG4gICAgICBpZHMucHVzaChpZCk7XG4gICAgfVxuICAgIHJldHVybiBpZHM7XG4gIH07XG5cbiAgYnVpbGRlcihbYXN0XSwgXCJkb2N1bWVudFwiKTtcbiAgb3V0LnB1c2goJ30nKTtcbiAgcmV0dXJuIG91dC5qb2luKFwiXFxuXCIpO1xufTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==