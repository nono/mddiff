"use strict";

var cmark = require("commonmark");

exports.parseAST = function (markdown) {
  var transform = function (items) {
    for (var _iterator = items[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {
      var item = _step.value;
      if (item.children) {
        transform(item.children);
      }

      // Split lines of code for fenced code, to improve diffs
      if (item.t === "FencedCode") {
        item.inline_content = item.string_content.split("\n").slice(0, -1).map(function (l) {
          return ({ t: "CodeLine", c: l });
        });
        item.string_content = null;
      }
    }
  };

  var reader = new cmark.DocParser();
  var ast = reader.parse(markdown);
  transform([ast]);
  return ast;
};
"use strict";

var shapes = {
  document: "note",
  block: "box",
  inline: "oval" };


var solarizedLight = {
  back: "#fdf6e3",
  fill: "#eee8d5",
  font: "#073642",
  strg: "#586e75",
  edge: "#002b36",
  code: "#268bd2" };

var solarizedDark = {
  back: "#002b36",
  fill: "#073642",
  font: "#fdf6e3",
  strg: "#eee8d5",
  edge: "#93a1a1",
  code: "#2aa198" };

exports.palettes = { solarizedLight: solarizedLight, solarizedDark: solarizedDark };


var defaults = {
  palette: solarizedLight,
  fontsize: 14,
  fontname: "Inconsolata" };


exports.exportDot = function (ast, filename, options) {
  if (options === undefined) options = {};
  var pal = options.palette || defaults.palette;
  var size = options.fontsize || defaults.fontsize;
  var font = options.fontname || defaults.fontname;

  var out = ["digraph \"" + filename + "\" {", "graph [rankdir=\"LR\", bgcolor=\"" + pal.back + "\"];", "node [style=\"filled\", fontcolor=\"" + pal.font + "\", fillcolor=\"" + pal.fill + "\", color=\"" + pal.edge + "\", fontsize=" + size + ", fontname=\"" + font + "\"];", "edge [color=\"" + pal.edge + "\"];"];
  var n = 0;

  var builder = function (items, type) {
    var ids = [];
    for (var _iterator = items[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {
      var item = _step.value;
      var id = n++;
      var children = [];
      if (item.children) {
        children = children.concat(builder(item.children, "block"));
      }
      if (item.inline_content) {
        children = children.concat(builder(item.inline_content, "inline"));
      }
      if (Array.isArray(item.c)) {
        children = children.concat(builder(item.c, "inline"));
      }
      if (Array.isArray(item.label)) {
        children = children.concat(builder(item.label, "inline"));
      }
      var shape = shapes[type];
      var label = item.t;
      var more = "";
      if (item.t === "Str") {
        label = "'" + item.c + "'";
        more = ", fontcolor=\"" + pal.strg + "\"";
      } else if (item.t === "CodeLine" || item.t === "Code") {
        label = item.c;
        more = ", fontcolor=\"" + pal.code + "\"";
      } else if (item.t === "Link") {
        more = ", href=\"" + item.destination + "\"";
      }
      label = label.replace(/["\\]/g, "\\$&");
      out.push("  n" + id + " [label=\"" + label + "\", shape=\"" + shape + "\"" + more + "];");
      for (var _iterator2 = children[Symbol.iterator](), _step2; !(_step2 = _iterator2.next()).done;) {
        var child = _step2.value;
        out.push("  n" + id + " -> n" + child + ";");
      }

      ids.push(id);
    }

    return ids;
  };

  builder([ast], "document");
  out.push("}");
  return out.join("\n");
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL25vbm8vZGV2L21kZGlmZi9zcmMvYXN0LmpzIiwiL2hvbWUvbm9uby9kZXYvbWRkaWZmL3NyYy9kb3QuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7O0FBRWxDLE9BQU8sQ0FBQyxRQUFRLEdBQUcsVUFBUyxRQUFRLEVBQUU7QUFDcEMsTUFBSSxTQUFTLEdBQUcsVUFBUyxLQUFLLEVBQUU7eUJBQ2IsS0FBSztVQUFiLElBQUk7QUFDWCxVQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7QUFDakIsaUJBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7T0FDMUI7OztBQUdELFVBQUksSUFBSSxDQUFDLENBQUMsS0FBSyxZQUFZLEVBQUU7QUFDM0IsWUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FDbEQsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUNaLEdBQUcsQ0FBQyxVQUFBLENBQUM7aUJBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxVQUFVLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO1NBQUEsQ0FBQyxDQUFDO0FBQ3ZDLFlBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO09BQzVCOztHQUVKLENBQUM7O0FBRUYsTUFBSSxNQUFNLEdBQUcsSUFBSSxLQUFLLENBQUMsU0FBUyxFQUFFLENBQUM7QUFDbkMsTUFBSSxHQUFHLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNqQyxXQUFTLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQ2pCLFNBQU8sR0FBRyxDQUFDO0NBQ1osQ0FBQzs7O0FDdkJGLElBQUksTUFBTSxHQUFHO0FBQ1gsVUFBUSxFQUFFLE1BQU07QUFDaEIsT0FBSyxFQUFFLEtBQUs7QUFDWixRQUFNLEVB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QUFJLE9BQUksQ0FBQztPQUN0QyxNQUFNLElBQUksSUFBSSxDQUFDLENBQUMsS0FBSyxVQUFVLElBQUksSUFBSSxDQUFDLENBQUMsS0FBSyxNQUFNLEVBQUU7QUFDckQsYUFBSyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7QUFDZixZQUFJLHNCQUFvQixHQUFHLENBQUMsSUFBSSxPQUFJLENBQUM7T0FDdEMsTUFBTSxJQUFJLElBQUksQ0FBQyxDQUFDLEtBQUssTUFBTSxFQUFFO0FBQzVCLFlBQUksaUJBQWUsSUFBSSxDQUFDLFdBQVcsT0FBSSxDQUFDO09BQ3pDO0FBQ0QsV0FBSyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ3hDLFNBQUcsQ0FBQyxJQUFJLFNBQVEsRUFBRSxrQkFBYyxLQUFLLG9CQUFlLEtBQUssVUFBTSxJQUFJLFFBQU0sQ0FBQzs0QkFDeEQsUUFBUTtZQUFqQixLQUFLO0FBQ1osV0FBRyxDQUFDLElBQUksU0FBUSxFQUFFLGFBQVUsS0FBSyxPQUFLLENBQUM7OztBQUV6QyxTQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDOzs7QUFFZixXQUFPLEdBQUcsQ0FBQztHQUNaLENBQUM7O0FBRUYsU0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsVUFBVSxDQUFDLENBQUM7QUFDM0IsS0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNkLFNBQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztDQUN2QixDQUFDIiwiZmlsZSI6Im1kZGlmZi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBjbWFyayA9IHJlcXVpcmUoXCJjb21tb25tYXJrXCIpO1xuXG5leHBvcnRzLnBhcnNlQVNUID0gZnVuY3Rpb24obWFya2Rvd24pIHtcbiAgdmFyIHRyYW5zZm9ybSA9IGZ1bmN0aW9uKGl0ZW1zKSB7XG4gICAgZm9yIChsZXQgaXRlbSBvZiBpdGVtcykge1xuICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4pIHtcbiAgICAgICAgdHJhbnNmb3JtKGl0ZW0uY2hpbGRyZW4pO1xuICAgICAgfVxuXG4gICAgICAvLyBTcGxpdCBsaW5lcyBvZiBjb2RlIGZvciBmZW5jZWQgY29kZSwgdG8gaW1wcm92ZSBkaWZmc1xuICAgICAgaWYgKGl0ZW0udCA9PT0gXCJGZW5jZWRDb2RlXCIpIHtcbiAgICAgICAgaXRlbS5pbmxpbmVfY29udGVudCA9IGl0ZW0uc3RyaW5nX2NvbnRlbnQuc3BsaXQoXCJcXG5cIilcbiAgICAgICAgICAuc2xpY2UoMCwgLTEpXG4gICAgICAgICAgLm1hcChsID0+ICh7IHQ6IFwiQ29kZUxpbmVcIiwgYzogbCB9KSk7XG4gICAgICAgIGl0ZW0uc3RyaW5nX2NvbnRlbnQgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBsZXQgcmVhZGVyID0gbmV3IGNtYXJrLkRvY1BhcnNlcigpO1xuICBsZXQgYXN0ID0gcmVhZGVyLnBhcnNlKG1hcmtkb3duKTtcbiAgdHJhbnNmb3JtKFthc3RdKTtcbiAgcmV0dXJuIGFzdDtcbn07XG4iLCJ2YXIgc2hhcGVzID0ge1xuICBkb2N1bWVudDogXCJub3RlXCIsXG4gIGJsb2NrOiBcImJveFwiLFxuICBpbmxpbmU6IFwib3ZhbFwiLFxufTtcblxuXG52YXIgc29sYXJpemVkTGlnaHQgPSB7XG4gIGJhY2s6IFwiI2ZkZjZlM1wiLFxuICBmaWxsOiBcIiNlZWU4ZDVcIixcbiAgZm9udDogXCIjMDczNjQyXCIsXG4gIHN0cmc6IFwiIzU4NmU3NVwiLFxuICBlZGdlOiBcIiMwMDJiMzZcIixcbiAgY29kZTogXCIjMjY4YmQyXCIsXG59O1xuXG52YXIgc29sYXJpemVkRGFyayA9IHtcbiAgYmFjazogXCIjMDAyYjM2XCIsXG4gIGZpbGw6IFwiIzA3MzY0MlwiLFxuICBmb250OiBcIiNmZGY2ZTNcIixcbiAgc3RyZzogXCIjZWVlOGQ1XCIsXG4gIGVkZ2U6IFwiIzkzYTFhMVwiLFxuICBjb2RlOiBcIiMyYWExOThcIixcbn07XG5cbmV4cG9ydHMucGFsZXR0ZXMgPSB7IHNvbGFyaXplZExpZ2h0LCBzb2xhcml6ZWREYXJrIH07XG5cblxudmFyIGRlZmF1bHRzID0ge1xuICBwYWxldHRlOiBzb2xhcml6ZWRMaWdodCxcbiAgZm9udHNpemU6IDE0LFxuICBmb250bmFtZTogXCJJbmNvbnNvbGF0YVwiLFxufTtcblxuXG5leHBvcnRzLmV4cG9ydERvdCA9IGZ1bmN0aW9uKGFzdCwgZmlsZW5hbWUsIG9wdGlvbnM9e30pIHtcbiAgbGV0IHBhbCAgPSBvcHRpb25zLnBhbGV0dGUgIHx8IGRlZmF1bHRzLnBhbGV0dGU7XG4gIGxldCBzaXplID0gb3B0aW9ucy5mb250c2l6ZSB8fCBkZWZhdWx0cy5mb250c2l6ZTtcbiAgbGV0IGZvbnQgPSBvcHRpb25zLmZvbnRuYW1lIHx8IGRlZmF1bHRzLmZvbnRuYW1lO1xuXG4gIGxldCBvdXQgPSBbYGRpZ3JhcGggXCIkeyBmaWxlbmFtZSB9XCIge2AsXG4gICAgICAgICAgICAgYGdyYXBoIFtyYW5rZGlyPVwiTFJcIiwgYmdjb2xvcj1cIiR7cGFsLmJhY2t9XCJdO2AsXG4gICAgICAgICAgICAgYG5vZGUgW3N0eWxlPVwiZmlsbGVkXCIsIGZvbnRjb2xvcj1cIiR7cGFsLmZvbnR9XCIsIGZpbGxjb2xvcj1cIiR7IHBhbC5maWxsIH1cIiwgY29sb3I9XCIkeyBwYWwuZWRnZSB9XCIsIGZvbnRzaXplPSR7IHNpemUgfSwgZm9udG5hbWU9XCIkeyBmb250IH1cIl07YCxcbiAgICAgICAgICAgICBgZWRnZSBbY29sb3I9XCIkeyBwYWwuZWRnZSB9XCJdO2BcbiAgICAgICAgICAgIF07XG4gIGxldCBuID0gMDtcblxuICB2YXIgYnVpbGRlciA9IGZ1bmN0aW9uKGl0ZW1zLCB0eXBlKSB7XG4gICAgbGV0IGlkcyA9IFtdO1xuICAgIGZvciAobGV0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgIGxldCBpZCA9IG4rKztcbiAgICAgIGxldCBjaGlsZHJlbiA9IFtdO1xuICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4pIHtcbiAgICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5jb25jYXQoYnVpbGRlcihpdGVtLmNoaWxkcmVuLCBcImJsb2NrXCIpKTtcbiAgICAgIH1cbiAgICAgIGlmIChpdGVtLmlubGluZV9jb250ZW50KSB7XG4gICAgICAgIGNoaWxkcmVuID0gY2hpbGRyZW4uY29uY2F0KGJ1aWxkZXIoaXRlbS5pbmxpbmVfY29udGVudCwgXCJpbmxpbmVcIikpO1xuICAgICAgfVxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbS5jKSkge1xuICAgICAgICBjaGlsZHJlbiA9IGNoaWxkcmVuLmNvbmNhdChidWlsZGVyKGl0ZW0uYywgXCJpbmxpbmVcIikpO1xuICAgICAgfVxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbS5sYWJlbCkpIHtcbiAgICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5jb25jYXQoYnVpbGRlcihpdGVtLmxhYmVsLCBcImlubGluZVwiKSk7XG4gICAgICB9XG4gICAgICBsZXQgc2hhcGUgPSBzaGFwZXNbdHlwZV07XG4gICAgICBsZXQgbGFiZWwgPSBpdGVtLnQ7XG4gICAgICBsZXQgbW9yZSA9IFwiXCI7XG4gICAgICBpZiAoaXRlbS50ID09PSBcIlN0clwiKSB7XG4gICAgICAgIGxhYmVsID0gYCckeyBpdGVtLmMgfSdgO1xuICAgICAgICBtb3JlID0gYCwgZm9udGNvbG9yPVwiJHsgcGFsLnN0cmcgfVwiYDtcbiAgICAgIH0gZWxzZSBpZiAoaXRlbS50ID09PSBcIkNvZGVMaW5lXCIgfHwgaXRlbS50ID09PSBcIkNvZGVcIikge1xuICAgICAgICBsYWJlbCA9IGl0ZW0uYztcbiAgICAgICAgbW9yZSA9IGAsIGZvbnRjb2xvcj1cIiR7IHBhbC5jb2RlIH1cImA7XG4gICAgICB9IGVsc2UgaWYgKGl0ZW0udCA9PT0gXCJMaW5rXCIpIHtcbiAgICAgICAgbW9yZSA9IGAsIGhyZWY9XCIkeyBpdGVtLmRlc3RpbmF0aW9uIH1cImA7XG4gICAgICB9XG4gICAgICBsYWJlbCA9IGxhYmVsLnJlcGxhY2UoL1tcIlxcXFxdL2csIFwiXFxcXCQmXCIpO1xuICAgICAgb3V0LnB1c2goYCAgbiR7IGlkIH0gW2xhYmVsPVwiJHsgbGFiZWwgfVwiLCBzaGFwZT1cIiR7IHNoYXBlIH1cIiR7IG1vcmUgfV07YCk7XG4gICAgICBmb3IgKGxldCBjaGlsZCBvZiBjaGlsZHJlbikge1xuICAgICAgICBvdXQucHVzaChgICBuJHsgaWQgfSAtPiBuJHsgY2hpbGQgfTtgKTtcbiAgICAgIH1cbiAgICAgIGlkcy5wdXNoKGlkKTtcbiAgICB9XG4gICAgcmV0dXJuIGlkcztcbiAgfTtcblxuICBidWlsZGVyKFthc3RdLCBcImRvY3VtZW50XCIpO1xuICBvdXQucHVzaCgnfScpO1xuICByZXR1cm4gb3V0LmpvaW4oXCJcXG5cIik7XG59O1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9