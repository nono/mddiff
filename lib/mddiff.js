"use strict";
var cmark = require("cmark");

exports.parseAST = function(markdown) {
  var transform = function(items) {
    for (var _iterator = items[Symbol.iterator](), _step; !(_step = _iterator.next()).done; ) {
      var _item = _step.value;
      if (_item.children) {
        transform(_item.children);
      }

      // Split lines of code for fenced code, to improve diffs
      if (_item.t === "FencedCode") {
        _item.inline_content = _item.string_content.split("\n")
          .map(function(l) {
          return { t: "CodeLine", c: l };
        });
        _item.string_content = null;
      }
    }
  };

  var _reader = new cmark.DocParser();
  var _ast = _reader.parse(markdown);
  transform([_ast]);
  return _ast;
};

"use strict";
var shapes = {
  document: "note",
  block: "box",
  inline: "oval",
};


var solarizedLight = {
  back: "#fdf6e3",
  fill: "#eee8d5",
  font: "#073642",
  strg: "#586e75",
  edge: "#002b36",
  code: "#268bd2",
};

var solarizedDark = {
  back: "#002b36",
  fill: "#073642",
  font: "#fdf6e3",
  strg: "#eee8d5",
  edge: "#93a1a1",
  code: "#2aa198",
};

exports.palettes = { solarizedLight: solarizedLight, solarizedDark: solarizedDark };


var defaults = {
  palette: solarizedLight,
  fontsize: 14,
  fontname: "Inconsolata",
};


exports.exportDot = function(ast, filename, options) {
  if (options === undefined)
    options = {};

  var _pal  = options.palette  || defaults.palette;
  var _size = options.fontsize || defaults.fontsize;
  var _font = options.fontname || defaults.fontname;

  var _out = ["digraph \"" + filename + "\" {",
             "graph [rankdir=\"LR\", bgcolor=\"" + _pal.back + "\"];",
             "node [style=\"filled\", fontcolor=\"" + _pal.font + "\", fillcolor=\"" + _pal.fill + "\", color=\"" + _pal.edge + "\", fontsize=" + _size + ", fontname=\"" + _font + "\"];",
             "edge [color=\"" + _pal.edge + "\"];"
            ];
  var _n = 0;

  var builder = function(_n) {
    return function(_out) {
      return function(_pal) {
        return function(items, type) {
          var _ids = [];

          for (var _iterator = items[Symbol.iterator](), _step; !(_step = _iterator.next()).done; ) {
            var _item = _step.value;
            var _id = _n++;
            var _children = [];
            if (_item.children) {
              _children = _children.concat(builder(_item.children, "block"));
            }
            if (_item.inline_content) {
              _children = _children.concat(builder(_item.inline_content, "inline"));
            }
            if (Array.isArray(_item.c)) {
              _children = _children.concat(builder(_item.c, "inline"));
            }
            if (Array.isArray(_item.label)) {
              _children = _children.concat(builder(_item.label, "inline"));
            }
            var _shape = shapes[type];
            var _label = _item.t;
            var _more = "";
            if (_item.t === "Str") {
              _label = "'" + _item.c + "'";
              _more = ", fontcolor=\"" + _pal.strg + "\"";
            } else if (_item.t === "CodeLine" || _item.t === "Code") {
              _label = _item.c;
              _more = ", fontcolor=\"" + _pal.code + "\"";
            } else if (_item.t === "Link") {
              _more = ", href=\"" + _item.destination + "\"";
            }
            _label = _label.replace(/["\\]/g, "\\$&");
            _out.push("  n" + _id + " [label=\"" + _label + "\", shape=\"" + _shape + "\"" + _more + "];");

            for (var _child, t$5$0 = regeneratorRuntime.values(_children), t$5$1; !(t$5$1 = t$5$0.next()).done; ) {
              _child = t$5$1.value;
              _out.push("  n" + _id + " -> n" + _child + ";");
            }

            _ids.push(_id);
          }

          return _ids;
        };
      };
    };
  }(_n)(_out)(_pal);

  builder([ast], "document");
  _out.push('}');
  return _out.join("\n");
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL25vbm8vZGV2L21kZGlmZi9zcmMvYXN0LmpzIiwiL2hvbWUvbm9uby9kZXYvbWRkaWZmL3NyYy9kb3QuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7O0FBRTVCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtFQUNwQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt5QkFDWCxDQUFDLENBQUMsQ0FBQyxDQUFDOztNQUNuQixDQUFDLEVBQUUsTUFBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO1FBQ2pCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztNQUMxQjs7O01BR0EsQ0FBQyxFQUFFLE1BQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7YUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7VUFDbEQsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFDO2lCQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtTQUFFLENBQUM7YUFDbEMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO01BQzVCOztHQUVIOztjQUVVLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztXQUN6QixTQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQy9CLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFDLENBQUM7RUFDaEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUs7QUFDWixDQUFDOzs7QUN0QkQsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtFQUNYLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2hCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNaLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEIsQ0FBQzs7O0FBR0QsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7RUFDbkIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2pCLENBQUM7O0FBRUQsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO0VBQ2xCLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNmLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNmLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNmLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNmLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNmLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNqQixDQUFDOztBQUVELENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxnQ0FBZ0IsK0JBQWdCLENBQUM7OztBQUdwRCxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtFQUNiLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7RUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0VBQ1osQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN6QixDQUFDOzs7QUFHRCxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFBTixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUFOLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUUsQ0FBQzs7WUFDMUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7V0FFdkMsRUFBRSxnQkFBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQU87dURBQ1MsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFNOzBEQUNQLENBQUMsQ0FBQyxDQUFDLENBQUMsNkJBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUMseUJBQW1CLENBQUMsQ0FBQyxDQUFDLENBQUMsOERBQWlEO29DQUN6SCxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pCO1NBQ0osRUFBRTs7RUFFUixDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFOzs7ZUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO21CQUN4QixFQUFFLENBQUM7OytCQUNNLENBQUMsQ0FBQyxDQUFDLENBQUM7O29CQUNaLElBQUcsQ0FBQzswQkFDRSxFQUFFLENBQUM7WUFDaEIsQ0FBQyxFQUFFLE1BQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTt3QkFDUixXQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3RDtZQUNBLENBQUMsRUFBRSxNQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7d0JBQ2QsV0FBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwRTtZQUNBLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBSyxDQUFDLENBQUMsQ0FBQyxFQUFFO3dCQUNoQixXQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2RDtZQUNBLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7d0JBQ3BCLFdBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0Q7dUJBQ1UsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7dUJBQ2IsT0FBTSxDQUFDO3NCQUNSLEVBQUUsQ0FBQztZQUNaLENBQUMsRUFBRSxNQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtxQkFDZCxhQUFXLENBQUMsT0FBSztvQkFDbEIseUJBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBSztZQUN0QyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO3FCQUMvQyxPQUFNLENBQUMsQ0FBQztvQkFDVCx5QkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFLO1lBQ3RDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtvQkFDdkIscUJBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFLO1lBQ3pDO21CQUNNLFFBQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDcEMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLG9GQUFnRSxDQUFDOzs7O2tCQUVwRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMscUNBQTZCLENBQUM7OztnQkFFckMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUcsQ0FBQzs7O1VBRWQsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUs7Ozs7bUJBQ1g7O0VBRUQsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztNQUN2QixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ2IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0NBQ3RCIiwiZmlsZSI6Im1kZGlmZi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBjbWFyayA9IHJlcXVpcmUoXCJjbWFya1wiKTtcblxuZXhwb3J0cy5wYXJzZUFTVCA9IGZ1bmN0aW9uKG1hcmtkb3duKSB7XG4gIHZhciB0cmFuc2Zvcm0gPSBmdW5jdGlvbihpdGVtcykge1xuICAgIGZvciAobGV0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgIGlmIChpdGVtLmNoaWxkcmVuKSB7XG4gICAgICAgIHRyYW5zZm9ybShpdGVtLmNoaWxkcmVuKTtcbiAgICAgIH1cblxuICAgICAgLy8gU3BsaXQgbGluZXMgb2YgY29kZSBmb3IgZmVuY2VkIGNvZGUsIHRvIGltcHJvdmUgZGlmZnNcbiAgICAgIGlmIChpdGVtLnQgPT09IFwiRmVuY2VkQ29kZVwiKSB7XG4gICAgICAgIGl0ZW0uaW5saW5lX2NvbnRlbnQgPSBpdGVtLnN0cmluZ19jb250ZW50LnNwbGl0KFwiXFxuXCIpXG4gICAgICAgICAgLm1hcChsID0+ICh7IHQ6IFwiQ29kZUxpbmVcIiwgYzogbCB9KSk7XG4gICAgICAgIGl0ZW0uc3RyaW5nX2NvbnRlbnQgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBsZXQgcmVhZGVyID0gbmV3IGNtYXJrLkRvY1BhcnNlcigpO1xuICBsZXQgYXN0ID0gcmVhZGVyLnBhcnNlKG1hcmtkb3duKTtcbiAgdHJhbnNmb3JtKFthc3RdKTtcbiAgcmV0dXJuIGFzdDtcbn07XG4iLCJ2YXIgc2hhcGVzID0ge1xuICBkb2N1bWVudDogXCJub3RlXCIsXG4gIGJsb2NrOiBcImJveFwiLFxuICBpbmxpbmU6IFwib3ZhbFwiLFxufTtcblxuXG52YXIgc29sYXJpemVkTGlnaHQgPSB7XG4gIGJhY2s6IFwiI2ZkZjZlM1wiLFxuICBmaWxsOiBcIiNlZWU4ZDVcIixcbiAgZm9udDogXCIjMDczNjQyXCIsXG4gIHN0cmc6IFwiIzU4NmU3NVwiLFxuICBlZGdlOiBcIiMwMDJiMzZcIixcbiAgY29kZTogXCIjMjY4YmQyXCIsXG59O1xuXG52YXIgc29sYXJpemVkRGFyayA9IHtcbiAgYmFjazogXCIjMDAyYjM2XCIsXG4gIGZpbGw6IFwiIzA3MzY0MlwiLFxuICBmb250OiBcIiNmZGY2ZTNcIixcbiAgc3RyZzogXCIjZWVlOGQ1XCIsXG4gIGVkZ2U6IFwiIzkzYTFhMVwiLFxuICBjb2RlOiBcIiMyYWExOThcIixcbn07XG5cbmV4cG9ydHMucGFsZXR0ZXMgPSB7IHNvbGFyaXplZExpZ2h0LCBzb2xhcml6ZWREYXJrIH07XG5cblxudmFyIGRlZmF1bHRzID0ge1xuICBwYWxldHRlOiBzb2xhcml6ZWRMaWdodCxcbiAgZm9udHNpemU6IDE0LFxuICBmb250bmFtZTogXCJJbmNvbnNvbGF0YVwiLFxufTtcblxuXG5leHBvcnRzLmV4cG9ydERvdCA9IGZ1bmN0aW9uKGFzdCwgZmlsZW5hbWUsIG9wdGlvbnM9e30pIHtcbiAgbGV0IHBhbCAgPSBvcHRpb25zLnBhbGV0dGUgIHx8IGRlZmF1bHRzLnBhbGV0dGU7XG4gIGxldCBzaXplID0gb3B0aW9ucy5mb250c2l6ZSB8fCBkZWZhdWx0cy5mb250c2l6ZTtcbiAgbGV0IGZvbnQgPSBvcHRpb25zLmZvbnRuYW1lIHx8IGRlZmF1bHRzLmZvbnRuYW1lO1xuXG4gIGxldCBvdXQgPSBbYGRpZ3JhcGggXCIkeyBmaWxlbmFtZSB9XCIge2AsXG4gICAgICAgICAgICAgYGdyYXBoIFtyYW5rZGlyPVwiTFJcIiwgYmdjb2xvcj1cIiR7cGFsLmJhY2t9XCJdO2AsXG4gICAgICAgICAgICAgYG5vZGUgW3N0eWxlPVwiZmlsbGVkXCIsIGZvbnRjb2xvcj1cIiR7cGFsLmZvbnR9XCIsIGZpbGxjb2xvcj1cIiR7IHBhbC5maWxsIH1cIiwgY29sb3I9XCIkeyBwYWwuZWRnZSB9XCIsIGZvbnRzaXplPSR7IHNpemUgfSwgZm9udG5hbWU9XCIkeyBmb250IH1cIl07YCxcbiAgICAgICAgICAgICBgZWRnZSBbY29sb3I9XCIkeyBwYWwuZWRnZSB9XCJdO2BcbiAgICAgICAgICAgIF07XG4gIGxldCBuID0gMDtcblxuICB2YXIgYnVpbGRlciA9IGZ1bmN0aW9uKGl0ZW1zLCB0eXBlKSB7XG4gICAgbGV0IGlkcyA9IFtdO1xuICAgIGZvciAobGV0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgIGxldCBpZCA9IG4rKztcbiAgICAgIGxldCBjaGlsZHJlbiA9IFtdO1xuICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4pIHtcbiAgICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5jb25jYXQoYnVpbGRlcihpdGVtLmNoaWxkcmVuLCBcImJsb2NrXCIpKTtcbiAgICAgIH1cbiAgICAgIGlmIChpdGVtLmlubGluZV9jb250ZW50KSB7XG4gICAgICAgIGNoaWxkcmVuID0gY2hpbGRyZW4uY29uY2F0KGJ1aWxkZXIoaXRlbS5pbmxpbmVfY29udGVudCwgXCJpbmxpbmVcIikpO1xuICAgICAgfVxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbS5jKSkge1xuICAgICAgICBjaGlsZHJlbiA9IGNoaWxkcmVuLmNvbmNhdChidWlsZGVyKGl0ZW0uYywgXCJpbmxpbmVcIikpO1xuICAgICAgfVxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbS5sYWJlbCkpIHtcbiAgICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5jb25jYXQoYnVpbGRlcihpdGVtLmxhYmVsLCBcImlubGluZVwiKSk7XG4gICAgICB9XG4gICAgICBsZXQgc2hhcGUgPSBzaGFwZXNbdHlwZV07XG4gICAgICBsZXQgbGFiZWwgPSBpdGVtLnQ7XG4gICAgICBsZXQgbW9yZSA9IFwiXCI7XG4gICAgICBpZiAoaXRlbS50ID09PSBcIlN0clwiKSB7XG4gICAgICAgIGxhYmVsID0gYCckeyBpdGVtLmMgfSdgO1xuICAgICAgICBtb3JlID0gYCwgZm9udGNvbG9yPVwiJHsgcGFsLnN0cmcgfVwiYDtcbiAgICAgIH0gZWxzZSBpZiAoaXRlbS50ID09PSBcIkNvZGVMaW5lXCIgfHwgaXRlbS50ID09PSBcIkNvZGVcIikge1xuICAgICAgICBsYWJlbCA9IGl0ZW0uYztcbiAgICAgICAgbW9yZSA9IGAsIGZvbnRjb2xvcj1cIiR7IHBhbC5jb2RlIH1cImA7XG4gICAgICB9IGVsc2UgaWYgKGl0ZW0udCA9PT0gXCJMaW5rXCIpIHtcbiAgICAgICAgbW9yZSA9IGAsIGhyZWY9XCIkeyBpdGVtLmRlc3RpbmF0aW9uIH1cImA7XG4gICAgICB9XG4gICAgICBsYWJlbCA9IGxhYmVsLnJlcGxhY2UoL1tcIlxcXFxdL2csIFwiXFxcXCQmXCIpO1xuICAgICAgb3V0LnB1c2goYCAgbiR7IGlkIH0gW2xhYmVsPVwiJHsgbGFiZWwgfVwiLCBzaGFwZT1cIiR7IHNoYXBlIH1cIiR7IG1vcmUgfV07YCk7XG4gICAgICBmb3IgKGxldCBjaGlsZCBvZiBjaGlsZHJlbikge1xuICAgICAgICBvdXQucHVzaChgICBuJHsgaWQgfSAtPiBuJHsgY2hpbGQgfTtgKTtcbiAgICAgIH1cbiAgICAgIGlkcy5wdXNoKGlkKTtcbiAgICB9XG4gICAgcmV0dXJuIGlkcztcbiAgfTtcblxuICBidWlsZGVyKFthc3RdLCBcImRvY3VtZW50XCIpO1xuICBvdXQucHVzaCgnfScpO1xuICByZXR1cm4gb3V0LmpvaW4oXCJcXG5cIik7XG59O1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9