"use strict";

var CMark = require("commonmark");
var VNode = require("virtual-dom/vnode/vnode");
var VText = require("virtual-dom/vnode/vtext");

exports.parseAST = function (markdown) {
  var reader = new CMark.Parser();
  var parsed = reader.parse(markdown);
  var walker = parsed.walker();

  var stack = [];
  var event = undefined;
  while (event = walker.next()) {
    var node = event.node;
    if (!event.entering) {
      // TODO props
      var children = stack.shift();
      var current = new VNode(node.type, {}, children);
      if (stack.length) {
        stack[0].push(current);
      } else {
        return current;
      }
    } else if (node.isContainer()) {
      stack.unshift([]);
    } else if (node.type === "Text") {
      var text = new VText(node.literal);
      stack[0].push(text);
    } else if (node.type === "CodeBlock") {
      var lines = node.literal.split("\n");
      lines.pop();
      lines = lines.map(function (line) {
        return new VText(line);
      });
      var code = new VNode(node.type, {}, lines);
      stack[0].push(code);
    } else {
      // TODO props
      // TODO literal inside it
      var leaf = new VNode(node.type, {});
      stack[0].push(leaf);
    }
  }

  throw new Error("Oops, can't create AST. It shouldn't happen...");
};
"use strict";

var vdiff = require("virtual-dom/diff");

exports.diff = vdiff;
"use strict";

var shapes = {
  document: "note",
  block: "box",
  inline: "oval" };


var solarizedLight = {
  back: "#fdf6e3",
  fill: "#eee8d5",
  font: "#073642",
  strg: "#586e75",
  edge: "#002b36",
  code: "#268bd2" };

var solarizedDark = {
  back: "#002b36",
  fill: "#073642",
  font: "#fdf6e3",
  strg: "#eee8d5",
  edge: "#93a1a1",
  code: "#2aa198" };

exports.palettes = { solarizedLight: solarizedLight, solarizedDark: solarizedDark };


var defaults = {
  palette: solarizedLight,
  fontsize: 14,
  fontname: "Inconsolata" };


exports.exportDot = function (ast, filename) {
  var options = arguments[2] === undefined ? {} : arguments[2];
  var pal = options.palette || defaults.palette;
  var size = options.fontsize || defaults.fontsize;
  var font = options.fontname || defaults.fontname;

  var out = ["digraph \"" + filename + "\" {", "graph [rankdir=\"LR\", bgcolor=\"" + pal.back + "\"];", "node [style=\"filled\", fontcolor=\"" + pal.font + "\", fillcolor=\"" + pal.fill + "\", color=\"" + pal.edge + "\", fontsize=" + size + ", fontname=\"" + font + "\"];", "edge [color=\"" + pal.edge + "\"];"];
  var n = 0;

  var builder = function (items, parent) {
    var ids = [];
    for (var _iterator = items[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {
      var item = _step.value;
      var id = n++;
      var children = [];
      var shape = shapes.inline;
      var label = item.tagName;
      var more = "";
      if (item.children) {
        children = builder(item.children, item.tagName);
        shape = shapes.block;
      }
      if (item.tagName === "Document") {
        shape = shapes.document;
      } else if (parent === "CodeBlock" || parent === "Code") {
        label = item.text;
        more = ", fontcolor=\"" + pal.code + "\"";
      } else if (item.type === "VirtualText") {
        label = "'" + item.text + "'";
        more = ", fontcolor=\"" + pal.strg + "\"";
      } else if (item.tagName === "Link" || item.tagName === "Image") {
        more = ", href=\"" + item.properties.href + "\"";
      }
      label = label.replace(/["\\]/g, "\\$&");
      out.push("  n" + id + " [label=\"" + label + "\", shape=\"" + shape + "\"" + more + "];");
      for (var _iterator2 = children[Symbol.iterator](), _step2; !(_step2 = _iterator2.next()).done;) {
        var child = _step2.value;
        out.push("  n" + id + " -> n" + child + ";");
      }
      ids.push(id);
    }
    return ids;
  };

  builder([ast]);
  out.push("}");
  return out.join("\n");
};
"use strict";

var fs = require("fs");

exports.readStdinOrFile = function (filename) {
  return new Promise(function (resolve, reject) {
    if (filename === "-") {
      (function () {
        var chunks = [];
        process.stdin.setEncoding("utf8");
        process.stdin.on("readable", function () {
          var chunk = process.stdin.read();
          if (chunk !== null) {
            chunks.push(chunk);
          }
        });
        process.stdin.on("end", function () {
          resolve(chunks.join(""));
        });
      })();
    } else {
      fs.readFile(filename, { encoding: "utf8" }, function (err, data) {
        if (err) {
          return reject("Error on reading " + filename + ": " + err);
        }
        resolve(data);
      });
    }
  });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzdC5qcyIsImRpZmYuanMiLCJkb3QuanMiLCJ1dGlscy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUNwQyxJQUFNLEtBQUssR0FBRyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQztBQUNqRCxJQUFNLEtBQUssR0FBRyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQzs7QUFFakQsT0FBTyxDQUFDLFFBQVEsR0FBRyxVQUFTLFFBQVEsRUFBRTtBQUNwQyxNQUFNLE1BQU0sR0FBRyxJQUFJLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNsQyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ3RDLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQzs7QUFFL0IsTUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDO0FBQ2YsTUFBSSxLQUFLLFlBQUEsQ0FBQztBQUNWLFNBQVEsS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLEVBQUUsRUFBRztBQUM5QixRQUFNLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO0FBQ3hCLFFBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFOztBQUVuQixVQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDL0IsVUFBTSxPQUFPLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDbkQsVUFBSSxLQUFLLENBQUMsTUFBTSxFQUFFO0FBQ2hCLGFBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7T0FDeEIsTUFBTTtBQUNMLGVBQU8sT0FBTyxDQUFDO09BQ2hCO0tBQ0YsTUFBTSxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsRUFBRTtBQUM3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QUssS0FBSyxJQUFJLEVBQUU7QUFDbEIsa0JBQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7V0FDcEI7U0FDRixDQUFDLENBQUM7QUFDSCxlQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsWUFBVztBQUNqQyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUMxQixDQUFDLENBQUM7O0tBQ0osTUFBTTtBQUNMLFFBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxFQUFFLFVBQVMsR0FBRyxFQUFFLElBQUksRUFBRTtBQUM5RCxZQUFJLEdBQUcsRUFBRTtBQUNQLGlCQUFPLE1BQU0sdUJBQXNCLFFBQVEsVUFBTyxHQUFHLENBQUksQ0FBQztTQUMzRDtBQUNELGVBQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztPQUNmLENBQUMsQ0FBQztLQUNKO0dBRUYsQ0FBQyxDQUFDO0NBQ0osQ0FBQyIsImZpbGUiOiJtZGRpZmYuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBDTWFyayA9IHJlcXVpcmUoXCJjb21tb25tYXJrXCIpO1xuY29uc3QgVk5vZGUgPSByZXF1aXJlKFwidmlydHVhbC1kb20vdm5vZGUvdm5vZGVcIik7XG5jb25zdCBWVGV4dCA9IHJlcXVpcmUoXCJ2aXJ0dWFsLWRvbS92bm9kZS92dGV4dFwiKTtcblxuZXhwb3J0cy5wYXJzZUFTVCA9IGZ1bmN0aW9uKG1hcmtkb3duKSB7XG4gIGNvbnN0IHJlYWRlciA9IG5ldyBDTWFyay5QYXJzZXIoKTtcbiAgY29uc3QgcGFyc2VkID0gcmVhZGVyLnBhcnNlKG1hcmtkb3duKTtcbiAgY29uc3Qgd2Fsa2VyID0gcGFyc2VkLndhbGtlcigpO1xuXG4gIGxldCBzdGFjayA9IFtdO1xuICBsZXQgZXZlbnQ7XG4gIHdoaWxlICgoZXZlbnQgPSB3YWxrZXIubmV4dCgpKSkge1xuICAgIGNvbnN0IG5vZGUgPSBldmVudC5ub2RlO1xuICAgIGlmICghZXZlbnQuZW50ZXJpbmcpIHtcbiAgICAgIC8vIFRPRE8gcHJvcHNcbiAgICAgIGNvbnN0IGNoaWxkcmVuID0gc3RhY2suc2hpZnQoKTtcbiAgICAgIGNvbnN0IGN1cnJlbnQgPSBuZXcgVk5vZGUobm9kZS50eXBlLCB7fSwgY2hpbGRyZW4pO1xuICAgICAgaWYgKHN0YWNrLmxlbmd0aCkge1xuICAgICAgICBzdGFja1swXS5wdXNoKGN1cnJlbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnQ7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChub2RlLmlzQ29udGFpbmVyKCkpIHtcbiAgICAgIHN0YWNrLnVuc2hpZnQoW10pO1xuICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAnVGV4dCcpIHtcbiAgICAgIGNvbnN0IHRleHQgPSBuZXcgVlRleHQobm9kZS5saXRlcmFsKTtcbiAgICAgIHN0YWNrWzBdLnB1c2godGV4dCk7XG4gICAgfSBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdDb2RlQmxvY2snKSB7XG4gICAgICBsZXQgbGluZXMgPSBub2RlLmxpdGVyYWwuc3BsaXQoJ1xcbicpO1xuICAgICAgbGluZXMucG9wKCk7XG4gICAgICBsaW5lcyA9IGxpbmVzLm1hcCgobGluZSkgPT4gbmV3IFZUZXh0KGxpbmUpKTtcbiAgICAgIGNvbnN0IGNvZGUgPSBuZXcgVk5vZGUobm9kZS50eXBlLCB7fSwgbGluZXMpO1xuICAgICAgc3RhY2tbMF0ucHVzaChjb2RlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVE9ETyBwcm9wc1xuICAgICAgLy8gVE9ETyBsaXRlcmFsIGluc2lkZSBpdFxuICAgICAgY29uc3QgbGVhZiA9IG5ldyBWTm9kZShub2RlLnR5cGUsIHt9KTtcbiAgICAgIHN0YWNrWzBdLnB1c2gobGVhZik7XG4gICAgfVxuICB9XG5cbiAgdGhyb3cgbmV3IEVycm9yKFwiT29wcywgY2FuJ3QgY3JlYXRlIEFTVC4gSXQgc2hvdWxkbid0IGhhcHBlbi4uLlwiKTtcbn07XG4iLCJjb25zdCB2ZGlmZiA9IHJlcXVpcmUoXCJ2aXJ0dWFsLWRvbS9kaWZmXCIpO1xuXG5leHBvcnRzLmRpZmYgPSB2ZGlmZjtcbiIsImNvbnN0IHNoYXBlcyA9IHtcbiAgZG9jdW1lbnQ6IFwibm90ZVwiLFxuICBibG9jazogXCJib3hcIixcbiAgaW5saW5lOiBcIm92YWxcIixcbn07XG5cblxuY29uc3Qgc29sYXJpemVkTGlnaHQgPSB7XG4gIGJhY2s6IFwiI2ZkZjZlM1wiLFxuICBmaWxsOiBcIiNlZWU4ZDVcIixcbiAgZm9udDogXCIjMDczNjQyXCIsXG4gIHN0cmc6IFwiIzU4NmU3NVwiLFxuICBlZGdlOiBcIiMwMDJiMzZcIixcbiAgY29kZTogXCIjMjY4YmQyXCIsXG59O1xuXG5jb25zdCBzb2xhcml6ZWREYXJrID0ge1xuICBiYWNrOiBcIiMwMDJiMzZcIixcbiAgZmlsbDogXCIjMDczNjQyXCIsXG4gIGZvbnQ6IFwiI2ZkZjZlM1wiLFxuICBzdHJnOiBcIiNlZWU4ZDVcIixcbiAgZWRnZTogXCIjOTNhMWExXCIsXG4gIGNvZGU6IFwiIzJhYTE5OFwiLFxufTtcblxuZXhwb3J0cy5wYWxldHRlcyA9IHsgc29sYXJpemVkTGlnaHQsIHNvbGFyaXplZERhcmsgfTtcblxuXG5jb25zdCBkZWZhdWx0cyA9IHtcbiAgcGFsZXR0ZTogc29sYXJpemVkTGlnaHQsXG4gIGZvbnRzaXplOiAxNCxcbiAgZm9udG5hbWU6IFwiSW5jb25zb2xhdGFcIixcbn07XG5cblxuZXhwb3J0cy5leHBvcnREb3QgPSBmdW5jdGlvbihhc3QsIGZpbGVuYW1lLCBvcHRpb25zPXt9KSB7XG4gIGNvbnN0IHBhbCAgPSBvcHRpb25zLnBhbGV0dGUgIHx8IGRlZmF1bHRzLnBhbGV0dGU7XG4gIGNvbnN0IHNpemUgPSBvcHRpb25zLmZvbnRzaXplIHx8IGRlZmF1bHRzLmZvbnRzaXplO1xuICBjb25zdCBmb250ID0gb3B0aW9ucy5mb250bmFtZSB8fCBkZWZhdWx0cy5mb250bmFtZTtcblxuICBsZXQgb3V0ID0gW2BkaWdyYXBoIFwiJHsgZmlsZW5hbWUgfVwiIHtgLFxuICAgICAgICAgICAgIGBncmFwaCBbcmFua2Rpcj1cIkxSXCIsIGJnY29sb3I9XCIkeyBwYWwuYmFjayB9XCJdO2AsXG4gICAgICAgICAgICAgYG5vZGUgW3N0eWxlPVwiZmlsbGVkXCIsIGZvbnRjb2xvcj1cIiR7IHBhbC5mb250IH1cIiwgZmlsbGNvbG9yPVwiJHsgcGFsLmZpbGwgfVwiLCBjb2xvcj1cIiR7IHBhbC5lZGdlIH1cIiwgZm9udHNpemU9JHsgc2l6ZSB9LCBmb250bmFtZT1cIiR7IGZvbnQgfVwiXTtgLFxuICAgICAgICAgICAgIGBlZGdlIFtjb2xvcj1cIiR7IHBhbC5lZGdlIH1cIl07YFxuICAgICAgICAgICAgXTtcbiAgbGV0IG4gPSAwO1xuXG4gIHZhciBidWlsZGVyID0gZnVuY3Rpb24oaXRlbXMsIHBhcmVudCkge1xuICAgIGxldCBpZHMgPSBbXTtcbiAgICBmb3IgKGxldCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgICBsZXQgaWQgPSBuKys7XG4gICAgICBsZXQgY2hpbGRyZW4gPSBbXTtcbiAgICAgIGxldCBzaGFwZSA9IHNoYXBlcy5pbmxpbmU7XG4gICAgICBsZXQgbGFiZWwgPSBpdGVtLnRhZ05hbWU7XG4gICAgICBsZXQgbW9yZSA9IFwiXCI7XG4gICAgICBpZiAoaXRlbS5jaGlsZHJlbikge1xuICAgICAgICBjaGlsZHJlbiA9IGJ1aWxkZXIoaXRlbS5jaGlsZHJlbiwgaXRlbS50YWdOYW1lKTtcbiAgICAgICAgc2hhcGUgPSBzaGFwZXMuYmxvY2s7XG4gICAgICB9XG4gICAgICBpZiAoaXRlbS50YWdOYW1lID09PSBcIkRvY3VtZW50XCIpIHtcbiAgICAgICAgc2hhcGUgPSBzaGFwZXMuZG9jdW1lbnQ7XG4gICAgICB9IGVsc2UgaWYgKHBhcmVudCA9PT0gXCJDb2RlQmxvY2tcIiB8fCBwYXJlbnQgPT09IFwiQ29kZVwiKSB7XG4gICAgICAgIGxhYmVsID0gaXRlbS50ZXh0O1xuICAgICAgICBtb3JlID0gYCwgZm9udGNvbG9yPVwiJHsgcGFsLmNvZGUgfVwiYDtcbiAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlID09PSBcIlZpcnR1YWxUZXh0XCIpIHtcbiAgICAgICAgbGFiZWwgPSBgJyR7IGl0ZW0udGV4dCB9J2A7XG4gICAgICAgIG1vcmUgPSBgLCBmb250Y29sb3I9XCIkeyBwYWwuc3RyZyB9XCJgO1xuICAgICAgfSBlbHNlIGlmIChpdGVtLnRhZ05hbWUgPT09IFwiTGlua1wiIHx8IGl0ZW0udGFnTmFtZSA9PT0gXCJJbWFnZVwiKSB7XG4gICAgICAgIG1vcmUgPSBgLCBocmVmPVwiJHsgaXRlbS5wcm9wZXJ0aWVzLmhyZWYgfVwiYDtcbiAgICAgIH1cbiAgICAgIGxhYmVsID0gbGFiZWwucmVwbGFjZSgvW1wiXFxcXF0vZywgXCJcXFxcJCZcIik7XG4gICAgICBvdXQucHVzaChgICBuJHsgaWQgfSBbbGFiZWw9XCIkeyBsYWJlbCB9XCIsIHNoYXBlPVwiJHsgc2hhcGUgfVwiJHsgbW9yZSB9XTtgKTtcbiAgICAgIGZvciAobGV0IGNoaWxkIG9mIGNoaWxkcmVuKSB7XG4gICAgICAgIG91dC5wdXNoKGAgIG4keyBpZCB9IC0+IG4keyBjaGlsZCB9O2ApO1xuICAgICAgfVxuICAgICAgaWRzLnB1c2goaWQpO1xuICAgIH1cbiAgICByZXR1cm4gaWRzO1xuICB9O1xuXG4gIGJ1aWxkZXIoW2FzdF0pO1xuICBvdXQucHVzaCgnfScpO1xuICByZXR1cm4gb3V0LmpvaW4oXCJcXG5cIik7XG59O1xuIiwiY29uc3QgZnMgPSByZXF1aXJlKFwiZnNcIik7XG5cbmV4cG9ydHMucmVhZFN0ZGluT3JGaWxlID0gZnVuY3Rpb24oZmlsZW5hbWUpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgaWYgKGZpbGVuYW1lID09PSBcIi1cIikge1xuICAgICAgbGV0IGNodW5rcyA9IFtdO1xuICAgICAgcHJvY2Vzcy5zdGRpbi5zZXRFbmNvZGluZyhcInV0ZjhcIik7XG4gICAgICBwcm9jZXNzLnN0ZGluLm9uKFwicmVhZGFibGVcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IGNodW5rID0gcHJvY2Vzcy5zdGRpbi5yZWFkKCk7XG4gICAgICAgIGlmIChjaHVuayAhPT0gbnVsbCkge1xuICAgICAgICAgIGNodW5rcy5wdXNoKGNodW5rKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBwcm9jZXNzLnN0ZGluLm9uKFwiZW5kXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKGNodW5rcy5qb2luKFwiXCIpKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBmcy5yZWFkRmlsZShmaWxlbmFtZSwgeyBlbmNvZGluZzogXCJ1dGY4XCIgfSwgZnVuY3Rpb24oZXJyLCBkYXRhKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KGBFcnJvciBvbiByZWFkaW5nICR7IGZpbGVuYW1lIH06ICR7IGVyciB9YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2ZShkYXRhKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICB9KTtcbn07XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=